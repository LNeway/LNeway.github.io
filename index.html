<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Learning">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Learning</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Learning</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/22/æ¶²åŒ–æ•ˆæœçš„å¿ƒå¾—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/22/æ¶²åŒ–æ•ˆæœçš„å¿ƒå¾—/" itemprop="url">OpenGL ç‰‡æ®µç€è‰²å™¨ç†è§£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-11-22T21:44:46+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ€æ–°åœ¨åšä½¿ç”¨opengl æ¥å®ç°å›¾ç‰‡çš„æ¶²åŒ–æ•ˆæœï¼Œä»è€Œä¸ºé™æ€å›¾ç‰‡æ·»åŠ åŠ¨æ€çš„æ•ˆæœã€‚</p>
<p>å¯ä»¥é€šè¿‡ä¸€å¥è¯æ¥æ€»ç»“ä¸€ä¸‹å®ç°çš„åŸç†:é€šè¿‡ç‰‡æ®µç€è‰²å™¨æ¥æ¥è®¡ç®—æ¯ä¸€ä¸ªåƒç´ ç‚¹åº”è¯¥æ˜¾ç¤ºçš„é¢œè‰²åœ¨çº¹ç†ä¸Šçš„ä½ç½®ï¼Œä»è€Œå®ç°ä¿®æ”¹æ¸²æŸ“åƒç´ é¢œè‰²çš„åŠŸèƒ½ã€‚</p>
<p>å®ç°å¯ä»¥çœ‹ä¸‹é¢çš„å‡½æ•°:</p>
<p>â€‹            vec2 curveStretchFun(vec2 curCoord, vec2 originPosition, float radius)</p>
<p>{</p>
<p>  float currentDistance = distance(curCoord, originPosition);</p>
<p>  if (currentDistance &lt; radius) {</p>
<p>â€‹      vec2 currentDirection = (curCoord - originPosition) / length(curCoord - originPosition);</p>
<p>â€‹      float angle = dot(currentDirection, vec2(1, 0));</p>
<p>â€‹      float value45 = sin(-90.0);</p>
<p>â€‹      float value135 = sin(90.0);</p>
<p>â€‹      if (angle &gt; value45 &amp;&amp; angle &lt; value135 &amp;&amp; currentDirection.y &gt; 0.0) {</p>
<p>â€‹          curCoord = originPosition;</p>
<p>â€‹          return curCoord ;</p>
<p>â€‹      } else {</p>
<p>â€‹        return curCoord - vec2(0, 0);</p>
<p>â€‹      }</p>
<p>  } else {</p>
<p>â€‹      return curCoord - vec2(0, 0);</p>
<p>  }        </p>
<p>è¿™é‡Œä¼ è¿›æ¥çš„curCoord å®é™…ä¸Šæ˜¯å½“å‰åƒç´ ç‚¹çš„åæ ‡ï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®—originPosition(æ¶²åŒ–ä½œç”¨çš„èµ·å§‹ç‚¹)å’Œå½“å‰åæ ‡çš„è·ç¦»åˆ¤æ–­å½“å‰åƒç´ ç‚¹æ˜¯å¦åœ¨ä½œç”¨èŒƒå›´ä¹‹å†…ï¼Œå¦‚æœä¸åœ¨ï¼Œé‚£ä¹ˆå°±ä¸ä¼šä¿®æ”¹å½“å‰åƒç´ çš„åæ ‡ï¼Œ(é€šè¿‡ä¿®æ”¹åæ ‡æ¥å½±å“åœ¨çº¹ç†ä¸Šå–åƒç´ æœ€ç»ˆä¿®æ”¹å½“å‰åæ ‡æ˜¾ç¤ºçš„é¢œè‰²)ã€‚åœ¨è¿™ä¸ªç®€å•çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å§ä¸€ä¸ªèŒƒå›´çš„æ‰€æœ‰é¢œè‰²å…¨éƒ¨æ˜¾ç¤ºä¸ºoriginPosition åœ¨çº¹ç†ä¸Šå¯¹åº”çš„é¢œè‰²ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/23/Androidå®æ—¶æ»¤é•œå®ç°åŸç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/23/Androidå®æ—¶æ»¤é•œå®ç°åŸç†/" itemprop="url">Androidå®æ—¶æ»¤é•œå®ç°åŸç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-10-23T22:24:56+08:00">
                2017-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##åŸç†##</p>
<p>åœ¨Androidä¸­ï¼Œç›®å‰å¯ä»¥ä½¿ç”¨Opengl æ¥å®æ—¶çš„é¢„è§ˆç›¸æœºç•Œé¢ï¼Œé€šè¿‡è¿™ç›¸æœºçš„é¢„è§ˆç•Œé¢æˆ‘ä»¬å°±å¯ä»¥å®ç°æ»¤é•œçš„åŸºæœ¬åŠŸèƒ½ã€‚</p>
<p>ä½¿ç”¨OpenGL æ¥å®ç°ç›¸æœºçš„é¢„è§ˆç•Œé¢ç½‘ä¸Šçš„ä»£ç å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼Œä¸»è¦è®°å½•ä¸€ä¸‹ä½¿ç”¨OpenGLå®ç°æ»¤é•œçš„åŸç†ã€‚</p>
<p>åœ¨ç›¸æœºçš„é¢„è§ˆç•Œé¢ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ç›¸æœºçš„æ‰€é‡‡é›†åˆ°çš„æ•°æ®ç›´æ¥æ¸²æŸ“åˆ°äº†å±å¹•ä¸Šï¼Œè€Œæˆ‘ä»¬æ¸²æŸ“çš„å±å¹•å®é™…ä¸Šæ˜¯ç³»ç»Ÿé»˜è®¤æä¾›çš„ä¸€ä¸ªå«å¸§ç¼“å†²çš„åœ°æ–¹,è‹±æ–‡ä¸ºFrame Buffer Object ï¼ˆFBO) ï¼Œ æ—¢ç„¶ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å¸§ç¼“å†²å¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„å¸§ç¼“å†²å¯¹è±¡ï¼Œå°†æ•°æ®ç»˜åˆ¶åˆ°æˆ‘ä»¬åˆ›å»ºçš„å¸§ç¼“å†²å¯¹è±¡ä¸Šã€‚å…³äº<a href="http://blog.csdn.net/xiajun07061225/article/details/7283929" target="_blank" rel="external">FBO</a>çš„ç›¸å…³æ¦‚å¿µï¼Œå¯ä»¥å‚è§è¿™ç¯‡åšå®¢ã€‚</p>
<p>é€šè¿‡æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„å¸§ç¼“å†²å¯¹è±¡ï¼Œå¯ä»¥é™„åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¹ç†åœ¨è¿™ä¸ªå¸§ç¼“å†²åŒºå½“ä¸­ï¼Œæœ€ç»ˆæ¸²æŸ“åˆ°è¿™ä¸ªFrame bufferä¸­çš„æ•°æ®å®é™…ä¸Šéƒ½æ˜¯æ¸²æŸ“åˆ°äº†çº¹ç†å›¾åƒå½“ä¸­ï¼Œæ—¢ç„¶æœ‰äº†è¿™ä¸ªçº¹ç†å›¾åƒï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡Fragmetn shaderæ¥å®ç°å„ç§æ»¤é•œçš„æ•ˆæœã€‚</p>
<p>##å®ç°åŠæ€è€ƒ##</p>
<p>ä¸‹é¢è´´ä¸€ä¸‹å…³é”®çš„ä»£ç </p>
<p>ç»˜åˆ¶ç›¸æœºé¢„è§ˆç•Œé¢çš„ä»£ç ï¼Œåœ¨è¿™æ®µä»£ç ä¸­ï¼ŒæŠŠç›¸æœºçš„æ•°æ®ç»˜åˆ¶åˆ°äº†è‡ªå·±åˆ›å»ºçš„FBOå¯¹è±¡å½“ä¸­ã€‚</p>
<pre><code>if (fbo == null) {             
    fbo = FBO.createFBO(width, height);
}

GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, fbo.framebufferID);

GLES20.glViewport(0, 0, width, height);
GLES20.glClearColor(0, 0, 0, 0);
GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT | GLES20.GL_DEPTH_BUFFER_BIT);

GLES20.glUseProgram(mProgram);
GLES20.glActiveTexture(GLES20.GL_TEXTURE0);
GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, texture);

// get handle to vertex shader&apos;s vPosition member
mPositionHandle = GLES20.glGetAttribLocation(mProgram, &quot;vPosition&quot;);
beautyPosition = GLES20.glGetUniformLocation(mProgram, &quot;beauty&quot;);

GLES20.glUniform1i(beautyPosition,  isBeauty ? 1 : 0);

// Enable a handle to the triangle vertices
GLES20.glEnableVertexAttribArray(mPositionHandle);

// Prepare the &lt;insert shape here&gt; coordinate data
GLES20.glVertexAttribPointer(mPositionHandle, COORDS_PER_VERTEX, GLES20.GL_FLOAT, false, vertexStride, vertexBuffer);

mTextureCoordHandle = GLES20.glGetAttribLocation(mProgram, &quot;inputTextureCoordinate&quot;);
GLES20.glEnableVertexAttribArray(mTextureCoordHandle);


GLES20.glVertexAttribPointer(mTextureCoordHandle, COORDS_PER_VERTEX, GLES20.GL_FLOAT, false, vertexStride, textureVerticesBuffer);
GLES20.glDrawElements(GLES20.GL_TRIANGLES, drawOrder.length, GLES20.GL_UNSIGNED_SHORT, drawListBuffer);

// Disable vertex array
GLES20.glDisableVertexAttribArray(mPositionHandle);
GLES20.glDisableVertexAttribArray(mTextureCoordHandle);

// Switch to the default frame buffer
GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, 0);`
</code></pre><p><strong>åˆ›å»ºFBO</strong></p>
<pre><code>public class FBO {
       public int textureID;
    public int renderbuffersID;
    public int framebufferID;

    public static FBO createFBO(int width, int height) {
        FBO  fbo = new FBO();
        int[] texture = new int[1];
        int[] renderbuffersID = new int[1];
        int[] framebufferID = new int[1];

        GLES20.glGenTextures(1, texture, 0);
        GLES20.glGenFramebuffers(1, framebufferID, 0);
        GLES20.glGenRenderbuffers(1, renderbuffersID, 0);

        // renderbuffer
        GLES20.glBindRenderbuffer(GLES20.GL_RENDERBUFFER, renderbuffersID[0]);
        GLES20.glRenderbufferStorage(GLES20.GL_RENDERBUFFER, GLES20.GL_DEPTH_COMPONENT16, width, height);

        // framebuffer
        GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, framebufferID[0]);
        GLES20.glFramebufferRenderbuffer(GLES20.GL_FRAMEBUFFER, GLES20.GL_DEPTH_ATTACHMENT, GLES20.GL_RENDERBUFFER,
                framebufferID[0]);

        GLES20.glActiveTexture(GLES20.GL_TEXTURE0);
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture[0]);
        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_NEAREST);
        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR);
        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE);
        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE);
        GLES20.glTexImage2D(GLES20.GL_TEXTURE_2D, 0,
                GLES20.GL_RGBA, width, height, 0,
                GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE,
                null);

        GLES20.glFramebufferTexture2D(GLES20.GL_FRAMEBUFFER,
                GLES20.GL_COLOR_ATTACHMENT0, GLES20.GL_TEXTURE_2D,
                texture[0], 0);
        GLES20.glBindFramebuffer(GLES20.GL_FRAMEBUFFER, 0);

        fbo.textureID = texture[0];
        fbo.framebufferID = framebufferID[0];
        fbo.renderbuffersID = framebufferID[0];

        return fbo;
    }
}
</code></pre><p><strong>æ»¤é•œå¤„ç†</strong></p>
<p>åœ¨è¿™ä¸€æ­¥å°±æ˜¯å°†å‰é¢é™„åŠ çš„çº¹ç†ä½œä¸ºçº¹ç†å‚æ•°ä¼ é€’åˆ°Fragment shaderå½“ä¸­ï¼Œç„¶åå¯ä»¥å®ç°æ»¤é•œçš„æ•ˆæœäº†ã€‚</p>
<p>Fragment shaderä»£ç </p>
<pre><code>precision mediump float;
varying vec2 textureCoordinate;
uniform sampler2D inputImageTexture;

void main() {
    vec4 col = texture2D(inputImageTexture, textureCoordinate);
    float h = dot(col.rgb, vec3(0.3, 0.59, 0.21));
    gl_FragColor = vec4(h, h, h, col.a);
}
</code></pre><p>æ»¤é•œä»£ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">public void draw(int texture) &#123;</div><div class="line">    GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT | GLES20.GL_DEPTH_BUFFER_BIT);</div><div class="line"></div><div class="line">    GLES20.glActiveTexture(GLES20.GL_TEXTURE0);</div><div class="line">    GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture);</div><div class="line"></div><div class="line">    GLES20.glUseProgram(mProgram);</div><div class="line"></div><div class="line">    // get handle to vertex shader&apos;s vPosition member</div><div class="line">    mPositionHandle = GLES20.glGetAttribLocation(mProgram, &quot;vPosition&quot;);</div><div class="line"></div><div class="line">    // Enable a handle to the triangle vertices</div><div class="line">    GLES20.glEnableVertexAttribArray(mPositionHandle);</div><div class="line"></div><div class="line">    // Prepare the &lt;insert shape here&gt; coordinate data</div><div class="line">    GLES20.glVertexAttribPointer(mPositionHandle, COORDS_PER_VERTEX, GLES20.GL_FLOAT, false, vertexStride, vertexBuffer);</div><div class="line"></div><div class="line">    mTextureCoordHandle = GLES20.glGetAttribLocation(mProgram, &quot;inputTextureCoordinate&quot;);</div><div class="line">    GLES20.glEnableVertexAttribArray(mTextureCoordHandle);</div><div class="line"></div><div class="line">    GLES20.glVertexAttribPointer(mTextureCoordHandle, COORDS_PER_VERTEX, GLES20.GL_FLOAT, false, vertexStride, textureVerticesBuffer);</div><div class="line">    GLES20.glDrawElements(GLES20.GL_TRIANGLES, drawOrder.length, GLES20.GL_UNSIGNED_SHORT, drawListBuffer);</div><div class="line"></div><div class="line">    // Disable vertex array</div><div class="line">    GLES20.glDisableVertexAttribArray(mPositionHandle);</div><div class="line">    GLES20.glDisableVertexAttribArray(mTextureCoordHandle);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>æ€è€ƒ</strong></p>
<p>å®é™…ä¸Šåœ¨è‡ªå·±å®ç°çš„è¿‡ç¨‹ä¸­å‘ç°åº”è¯¥æ˜¯å¯ä»¥ç›´æ¥é¿å…åˆ°è‡ªå·±åˆ›å»ºFBOè¿™ä¸ªå¯¹è±¡æ¥å®ç°ç®€å•çš„æ»¤é•œçš„æ•ˆæœï¼Œä½†æ˜¯è¿™æ ·çš„è¯å„ç§æ»¤é•œé€‰æ‹©çš„é€»è¾‘çš„å¯èƒ½éƒ½ä¼šå­˜åœ¨ä¸€ä¸ªç±»å½“ä¸­ï¼Œè€Œä¸”åœ¨è¿™ä¸ªç»˜åˆ¶å¯¹åº”çš„Fragment Shader ä¹Ÿä¼šå­˜åœ¨è¿™ç§éœ€è¦å˜é‡å’Œå±æ€§ï¼Œä½†æ˜¯å¯¹åº”çš„å±æ€§å’Œå˜é‡åˆå¯èƒ½åªåœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ç”¨åˆ°ï¼Œè¿™å°±é€ æˆäº†éƒ¨åˆ†ä»£ç æ–‡ä»¶åŠå…¶è‡ƒè‚¿ï¼Œä»¥è‡³äºæ ¹æœ¬æ— æ³•æ‰©å±•ï¼Œè€Œé€šè¿‡FBO çš„æ–¹å¼ï¼Œè¿™æ ·ç›¸å½“äºå½¢æˆäº†ä¸€ä¸ªæµæ°´çº¿çš„æ–¹å¼ï¼Œæˆ‘ä»¬åªè¦æ‹¿åˆ°ä¸Šä¸€ä¸ªæ­¥éª¤æœ€ç»ˆç»˜åˆ¶çš„çº¹ç†ï¼Œå°±å¯ä»¥ç»§ç»­æ‹¼æ¥ä¸‹ä¸€æ­¥æ“ä½œï¼Œè¿™æ ·åœ¨æ•´ä¸ªæµç¨‹ä¸­æ’å…¥æƒ³è¦çš„æ­¥éª¤å°±ååˆ†å®¹æ˜“äº†ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/04/Replugin-å­¦ä¹ ç¬”è®°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/04/Replugin-å­¦ä¹ ç¬”è®°/" itemprop="url">Replugin å­¦ä¹ ç¬”è®°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-04T22:12:00+08:00">
                2017-09-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨Replugin è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œ360å®ç°äº†åªéœ€è¦hookä¸€ä¸ªç‚¹ï¼Œå°±å¯å®ç°æ’ä»¶åŒ–åŠ è½½ï¼Œè€Œè¿™ä¸ªç‚¹å°±æ˜¯classloaderã€‚ä¸ºä»€ä¹ˆhookè¿™ä¸ªç‚¹å°±èƒ½è§£å†³Activity åŠ¨æ€åŠ è½½çš„é—®é¢˜ï¼Œè¿™ä¸ªå°±è¦ä»æˆ‘ä»¬çš„Activityæ˜¯æ€ä¹ˆæ¥çš„è¯´èµ·äº†,Activityçš„å¯åŠ¨ä»£ç ç›¸å½“å¤æ‚ï¼Œåœ¨è¿™é‡Œå°±ä¸åˆ†æäº†ï¼Œç½‘ä¸Šæœ‰ä¸å°‘å¤§ç¥çš„blogéƒ½åˆ†æäº†è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä¸­è·Ÿhookç‚¹æœ€ç›¸å…³çš„å°±æ˜¯ä¸‹é¢çš„è¿™ä¸€æ®µã€‚<br>è¿™ä¸€æ®µä»ActivityThreadçš„ performLaunchActivity æ–¹æ³•ä¸­æ‘˜å‡ºï¼Œ</p>
<pre><code>Activity activity = null;
    try {
        java.lang.ClassLoader cl = r.packageInfo.getClassLoader();
        activity = mInstrumentation.newActivity(
                cl, component.getClassName(), r.intent);
        StrictMode.incrementExpectedActivityCount(activity.getClass());
        r.intent.setExtrasClassLoader(cl);
        r.intent.prepareToEnterProcess();
        if (r.state != null) {
            r.state.setClassLoader(cl);
        }
    } catch (Exception e) {
        if (!mInstrumentation.onException(activity, e)) {
            throw new RuntimeException(
                &quot;Unable to instantiate activity &quot; + component
                + &quot;: &quot; + e.toString(), e);
        }
    }
</code></pre><p>è¿›å…¥mInstrumentation çš„ newActivity æ–¹æ³•ï¼š</p>
<pre><code>public Activity newActivity(ClassLoader cl, String className,
        Intent intent)
        throws InstantiationException, IllegalAccessException,
        ClassNotFoundException {
    return (Activity)cl.loadClass(className).newInstance();
}
</code></pre><p>çœ‹åˆ°è¿™ä¸ªæ–¹æ³•æ˜¯ä¸æ˜¯å°±æœ‰ä¸€ç§æç„¶å¤§æ‚Ÿçš„æ„Ÿè§‰äº†ï¼Œæœ€ç»ˆçš„Activity å®ä¾‹æ˜¯é€šè¿‡å…¶ Activity çš„classå¯¹è±¡è°ƒç”¨newInstance()å¾—åˆ°çš„. æ‰€ä»¥åªéœ€è¦æ§åˆ¶äº† Activityçš„class å¯¹è±¡ï¼Œ å°±æ§åˆ¶äº†Activityçš„äº§ç”Ÿï¼Œè€Œè¿™ä¸ªclasså¯¹è±¡ï¼Œæ­£æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡hooKæ¥è§£å†³çš„ã€‚</p>
<p>åœ¨è¿™é‡ŒRelugin æ¡†æ¶è§£å†³äº†Activity æ€ä¹ˆæ¥çš„é—®é¢˜ï¼ŒåŒæ—¶å› ä¸ºActivityéœ€è¦åœ¨AndroidManifestä¸­æ³¨å†Œï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨Replugin æ¡†æ¶çš„æ—¶å€™ï¼Œæ¡†æ¶çš„æ’ä»¶ä¼šåœ¨ç”Ÿæˆçš„Apkæ–‡ä»¶ä¸­æ·»åŠ å¾ˆå¤šçš„Activityç»„ä»¶æ¥ä½œä¸ºä¸€ä¸ªä¸ªå å‘ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬å¯åŠ¨çš„ä¸€ä¸ªActivity A çš„æ—¶å€™ï¼ŒRelugin ä¼šå°†æˆ‘ä»¬çš„ç›®æ ‡Activityæ›¿æ¢ä¸ºå‘ä½ä¸­çš„ä¸€ä¸ªActivity AP ,ä½†æ˜¯åœ¨å®é™…è¿”å›è¿™ä¸ªActivityç›®æ ‡class å¯¹è±¡çš„æ—¶å€™ï¼Œè¿”å›çš„å´æ˜¯Activity A çš„class å¯¹è±¡ã€‚</p>
<p>èµ°å®Œè¿™ä¸ªæµç¨‹ï¼ŒReplugin çš„æ ¸å¿ƒåŸç†åº”è¯¥å°±ç®—æ˜¯æŒæ¡äº†ï¼Œè™½ç„¶è¯´å¾—è¿™ä¹ˆç®€å•ï¼Œä½†æ˜¯å…¶ä¸­æ¯ä¸ªæ­¥éª¤éƒ½ç›¸å½“çš„å¤æ‚ï¼Œç»§ç»­å­¦ä¹ å§ã€‚</p>
<p>å…·ä½“å®ç°å¯ä»¥çœ‹ä¸‹<a href="https://github.com/LNeway/PluginTest" target="_blank" rel="external">demo</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/02/Android-OpenGL-lookAt-å‡½æ•°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/02/Android-OpenGL-lookAt-å‡½æ•°/" itemprop="url">Android OpenGL lookAt å‡½æ•°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-09-02T16:05:34+08:00">
                2017-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android-OpenGL-3Dä¸­çš„LookAtçš„ç†è§£"><a href="#Android-OpenGL-3Dä¸­çš„LookAtçš„ç†è§£" class="headerlink" title="Android OpenGL 3Dä¸­çš„LookAtçš„ç†è§£"></a>Android OpenGL 3Dä¸­çš„LookAtçš„ç†è§£</h1><p>åœ¨openglä¸­çš„åæ ‡ç©ºé—´æœ‰å‡ ç§ï¼Œ ç‰©ä½“åæ ‡ï¼Œä¸–ç•Œåæ ‡ç³»ï¼Œç›¸æœºåæ ‡ç³»ï¼Œè£å‰ªç©ºé—´åæ ‡ç³»ã€‚</p>
<p>å…¶ä»–çš„å‡ ç§åæ ‡ç³»ç›¸å¯¹å¥½ç†è§£ï¼Œè¿™ä¸ªç›¸æœºåæ ‡ç³»åå¤è¯•éªŒæ‰æ˜ç™½å…¶ä¸­å«ä¹‰ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹å®‰å“ä¸­GLES20ä¸­çš„lookatMå‡½æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Matrix.setLookAtM(mViewMatrix, 0, eyeX, eyeY, eyeZ, lookX, lookY, lookZ, upX, upY, upZ);</div></pre></td></tr></table></figure>
<p>åœ¨æ–‡æ¡£ä¸­ç»™å‡ºçš„æ³¨é‡Šå¦‚ä¸‹ </p>
<blockquote>
<p>Defines a viewing transformation in terms of an eye point, a center of view, and an up vector.</p>
</blockquote>
<p>çœ‹ç€è¿™ä¸ªæ³¨é‡Šè¿˜æ˜¯æ²¡ç†è§£ã€‚</p>
<p>å‡½æ•°ä¸­çš„çš„å‚æ•°å‰ä¸¤ä¸ªå¯ä»¥å¿½ç•¥ï¼Œåé¢çš„ä¹ä¸ªå‚æ•°åˆ†ä¸ºä¸‰ç»„</p>
<p><strong>ç¬¬ä¸€ç»„æ˜¯çœ¼ç›åœ¨ç©ºé—´çš„åæ ‡</strong></p>
<p>è¿™ä¸ªå°±æ˜¯ç›¸æœºåœ¨ä¸€ä¸ªç©ºé—´ç›´è§’åæ ‡ç³»ä¸­çš„ç»å¯¹ä½ç½®</p>
<p><strong>ç¬¬äºŒç»„æ˜¯ç‰©ä½“åœ¨ç©ºé—´ä¸­çš„åæ ‡</strong></p>
<p>è¿™ä¸ªåæ ‡å°±æ˜¯æˆ‘ä»¬çœ‹çš„ç‰©ä½“åœ¨ç©ºé—´åæ ‡ç³»ä¸­çš„ä½ç½®ã€‚</p>
<p><strong>ç¬¬ä¸‰ç»„åæ ‡å®é™…ä¸Šæ˜¯ç›¸æœºé¡¶éƒ¨çš„çš„æŒ‡å‘</strong></p>
<p>è¿™é‡Œç¬¬ä¸‰ç»„å‚æ•°å†³å®šäº†ğŸ“·é¡¶éƒ¨æ–¹å‘ï¼Œå¤§å®¶ä½¿ç”¨è¿™ä¸ªå‚æ•°çš„æ—¶å€™å¯ä»¥æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬è‡ªå·±çš„çœ¼ç›çœ‹ä¸œè¥¿çš„æ—¶å€™ï¼Œå®é™…ä¸Šè¿™ä¸ªå‚æ•°çš„å€¼æ˜¯ï¼ˆ0, 1, 0ï¼‰,å› ä¸ºæŠŠæˆ‘ä»¬è‡ªå·±çš„å¤´æƒ³è±¡ç§°ä¸ºä¸€ä¸ªç›¸æœºï¼Œé‚£ä¹ˆè¿™ä¸ªç›¸æœºé¡¶éƒ¨å®é™…ä¸Šæ°¸è¿œæŒ‡å‘çš„å¤©ç©ºï¼ˆå‡è®¾å¤©ç©ºæ˜¯æ­£è½´æ–¹å‘ï¼‰ï¼Œç°åœ¨å‡è®¾æˆ‘ä»¬çœ‹å±å¹•çš„æ—¶å€™ï¼Œæƒ³æŠŠå±å¹•å€’ç€çœ‹ï¼Œé™¤äº†ä¸æ—‹è½¬å±å¹•ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé€‰é¡¹å°±æ˜¯è®©è‡ªå·±çš„å¤´é¡¶æœåœ°ï¼Œè¿™æ ·æˆ‘ä»¬çœ‹å±å¹•çš„æ—¶å€™å°±å¯ä»¥å®ç°å€’ç€çœ‹äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å‘é‡çš„å€¼åº”è¯¥æ˜¯(0, -1, 0)ã€‚</p>
<p>å…·ä½“çš„è¯å¤§å®¶å¯ä»¥çœ‹ä¸‹é¢çš„<a href="https://github.com/LNeway/OpenGL-learning" target="_blank" rel="external">ä¾‹å­</a>ï¼Œä¸‹é¢çš„å®ä¾‹ä¸­æˆ‘ä»¬çš„ç‰©ä½“å§‹ç»ˆéƒ½åœ¨ï¼ˆ0, 0, 0ï¼‰è¿™ä¸ªä½ç½®ä¸å˜ã€‚</p>
<p><img src="../images/WechatIMG1.png" alt=""></p>
<p>ç¬¬ä¸€ç»„æ•°æ®æ˜¯æˆ‘ä»¬çœ¼ç›çš„ä½ç½®ï¼Œç›®å‰å‚æ•°å€¼åœ¨ï¼ˆ-2ï¼Œ-2ï¼Œ2ï¼‰,ä¹Ÿå°±æ˜¯ä»ç«‹æ–¹ä½“çš„ä¸€ä¸ªé¡¶ç‚¹çš„æ­£ä¸Šæ–¹çœ‹è¿‡å»çš„ï¼Œç°åœ¨ï¼ˆupX, upY, upZï¼‰è¿™ç»„å‚æ•°è®¾å®šçš„å€¼æ˜¯(0, 1, 0), ç´«çº¢è‰²æ˜¯åœ¨å›¾å½¢ä¸‹é¢çš„ä½ç½®ï¼ŒæŒ‰ç…§ä¸Šé¢çš„è§£é‡Šï¼Œå¦‚æœæŠŠupYçš„å€¼æ”¹ä¸º-1ï¼Œè¡¨ç¤ºç›¸æœºé¡¶éƒ¨æ˜¯å‘ä¸‹äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æœ€ç»ˆçœ‹åˆ°çš„å›¾å½¢ï¼Œç´«çº¢è‰²æ˜¯åœ¨å›¾åƒçš„ä¸Šéƒ¨ã€‚</p>
<p><img src="../images/WechatIMG2.png" alt=""></p>
<h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ol>
<li>è¿™ä¸ªå‚æ•°çš„è®¾å®šä¸èƒ½å’Œè§†çº¿å¹³è¡Œï¼Œåœ¨è¿™ä¸ªä¾‹å­å½“ä¸­æˆ‘ä»¬çš„å‘é‡æ˜¯ï¼ˆ-2ï¼Œ-2ï¼Œ-2ï¼‰,å¦‚æœè®¾å®šè¿™ä¸ªupå€¼æ˜¯x * ï¼ˆ-2, -2, -2), é‚£ä¹ˆå°†çœ‹ä¸åˆ°ä»»ä½•å›¾åƒã€‚</li>
<li>è¿™ä¸ªå€¼å¾—å«ä¹‰æ˜¯è¡¨ç¤ºé¡¶ç‚¹æŒ‡å‘çš„æ–¹å‘ï¼Œæ‰€ä»¥æœ€ç»ˆå«ä¹‰æ˜¯åœ¨æ–¹å‘è¿™ä¸ªæ„æ€ä¸Šé¢ï¼Œæ‰€ä»¥ï¼ˆ0, -1, 0ï¼‰å’Œ ï¼ˆ0, -x, 0) (x çš„å–å€¼å¤§äº0) çš„å«ä¹‰æ˜¯ä¸€æ ·çš„ï¼Œæœ€ç»ˆçœ‹åˆ°çš„å›¾åƒä¹Ÿå°±æ²¡æœ‰åŒºåˆ«äº†ã€‚</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/27/Andorid-OpenGL-å¤šå±‚çº¹ç†/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/27/Andorid-OpenGL-å¤šå±‚çº¹ç†/" itemprop="url">Andorid OpenGL å¤šå±‚çº¹ç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-27T21:26:57+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨opengl å¯ä»¥ä½¿ç”¨å¤šä¸ªçº¹ç†å•å…ƒï¼Œä»è€Œå®ç°äº†ä½¿ç”¨å¤šæˆçº¹ç†æ¸²æŸ“ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿéœ€è¦ç»‘å®šå¤šä¸ªçº¹ç†å•å…ƒï¼Œç„¶ååœ¨GLSLä¸­ä½¿ç”¨å¤šä¸ªçº¹ç†ç»˜åˆ¶å³å¯ã€‚</p>
<p>è¯ä¸å¤šå°‘ç›´æ¥ä¸Šä»£ç </p>
<pre><code>public class TextureRender implements GLSurfaceView.Renderer {

private Context context;

private int program;
private final float vertext [] = {
        1, 1, 0,   // top right
        -1, 1, 0,  // top left
        -1, -1, 0, // bottom left
        1, -1, 0,  // bottom right
};

private final short position [] = {0, 1, 2, 2, 3, 0};


private FloatBuffer verextBuffer = null;
private ShortBuffer shortBuffer = null;
private FloatBuffer texBuffer;

private int v_position;
private int tex_position;
private int texture;
private int textureUniform;
private int matrix;
private int watermark;
private int watermarkUniform;

private float texure [] = {
        0f, 0f,
        1f, 0f,
        1f, 1f,
        0f, 1f };

public TextureRender(Context context){
    this.context =  context;
    verextBuffer = ByteBuffer.allocateDirect(vertext.length * 4)
            .order(ByteOrder.nativeOrder()).asFloatBuffer().put(vertext);
    verextBuffer.position(0);

    shortBuffer = ByteBuffer.allocateDirect(position.length * 2)
            .order(ByteOrder.nativeOrder()).asShortBuffer().put(position);
    shortBuffer.position(0);

    texBuffer = ByteBuffer.allocateDirect(texure.length * 4)
            .order(ByteOrder.nativeOrder()).asFloatBuffer().put(texure);
    texBuffer.position(0);
}

@Override
public void onSurfaceCreated(GL10 gl, EGLConfig config) {

    program = GLES20.glCreateProgram();
    int vertex = Util.createShade(GLES20.GL_VERTEX_SHADER,
            Util.readTextResourceFromRaw(context, R.raw.texture_vertex));
    int fragment = Util.createShade(GLES20.GL_FRAGMENT_SHADER,
            Util.readTextResourceFromRaw(context, R.raw.texture_fragment));

    GLES20.glAttachShader(program, vertex);
    GLES20.glAttachShader(program, fragment);
    GLES20.glLinkProgram(program);
    GLES20.glUseProgram(program);

    v_position = GLES20.glGetAttribLocation(program, &quot;aPos&quot;);
    GLES20.glEnableVertexAttribArray(v_position);
    GLES20.glVertexAttribPointer(v_position, 3, GLES20.GL_FLOAT, false, 12, verextBuffer);

    tex_position = GLES20.glGetAttribLocation(program, &quot;v_texCoord&quot;);
    GLES20.glEnableVertexAttribArray(tex_position);
    GLES20.glVertexAttribPointer(tex_position, 2, GLES20.GL_FLOAT, false, 0, texBuffer);

    textureUniform = GLES20.glGetUniformLocation(program, &quot;u_samplerTexture&quot;);
    GLES20.glUniform1i(textureUniform, 0);

    watermarkUniform = GLES20.glGetUniformLocation(program, &quot;watermark&quot;);
    GLES20.glUniform1i(watermarkUniform, 1);


    try {
        texture = Util.createTexture(BitmapFactory.decodeStream(context.getAssets().open(&quot;texture.png&quot;)));
        watermark = Util.createTexture(BitmapFactory.decodeStream(context.getAssets().open(&quot;watermark.png&quot;)));
    } catch (IOException e) {
        e.printStackTrace();
    }
}

@Override
public void onSurfaceChanged(GL10 gl, int width, int height) {
    GLES20.glViewport(0, 0, width, height);
    //è®¾ç½®ç›¸æœºä½ç½®
}

@Override
public void onDrawFrame(GL10 gl) {
    GLES20.glClearColor(0.0f, 0.0f, 0.0f, 0.0f);
    GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT);
    GLES20.glActiveTexture(GLES20.GL_TEXTURE0);
    GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture);
    GLES20.glActiveTexture(GLES20.GL_TEXTURE1);
    GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, watermark);

    // ç”¨ glDrawElements æ¥ç»˜åˆ¶ï¼ŒmVertexIndexBuffer æŒ‡å®šäº†é¡¶ç‚¹ç»˜åˆ¶é¡ºåº
    GLES20.glDrawElements(GLES20.GL_TRIANGLES, position.length,
            GLES20.GL_UNSIGNED_SHORT, shortBuffer);
}}
</code></pre><p>ä¸‹é¢æ˜¯createTextureæ–¹æ³•</p>
<pre><code>public static int createTexture(Bitmap bitmap) {
    int[] texture = new int[1];
    if (bitmap != null &amp;&amp; !bitmap.isRecycled()) {
        // ç”Ÿæˆçº¹ç†
        GLES20.glGenTextures(1, texture, 0);
        // ç”Ÿæˆçº¹ç†
        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture[0]);
        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE);
        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE);

        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR);
        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR);

        GLUtils.texImage2D(GLES20.GL_TEXTURE_2D, 0, bitmap, 0);
        return texture[0];
    }

    return 0;
}
</code></pre><p><strong>é¡¶ç‚¹ç€è‰²å™¨</strong></p>
<pre><code>attribute vec3 aPos;
attribute vec2 v_texCoord;
varying vec2 outTexCoord;
void main() {
    gl_Position =  vec4(aPos, 1.0);
    outTexCoord = v_texCoord;
}
</code></pre><p><strong>ç‰‡æ®µç€è‰²å™¨</strong></p>
<pre><code>precision mediump float;
varying vec2 outTexCoord;
uniform sampler2D u_samplerTexture;
uniform sampler2D watermark;
void main(){
 gl_FragColor = mix(texture2D(u_samplerTexture, outTexCoord) * vec4(0, 1, 0, 1),           texture2D(watermark, vec2(1.0 - outTexCoord.x, outTexCoord.y)), 0.2);
}
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/20/æ€§èƒ½ä¼˜åŒ–/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/20/æ€§èƒ½ä¼˜åŒ–/" itemprop="url">æ€§èƒ½ä¼˜åŒ–</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-20T22:15:15+08:00">
                2017-08-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æœ€è¿‘åœ¨åšä¸€ä¸ªç›¸æœºçš„çš„APPï¼Œå…¶ä¸­æ¶‰åŠåˆ°äº†å¾ˆå¤šä»¥å‰æ²¡æœ‰æ¥è§¦è¿‡çš„çŸ¥è¯†ï¼ŒAPPåšåˆ°ç°åœ¨åŠŸèƒ½ä¹Ÿéƒ½åŸºæœ¬å®Œæˆäº†ï¼Œç°åœ¨æœ‰å¿ƒæ€æŠŠç²¾åŠ›æ”¾åœ¨ä¸€äº›ä»¥å‰æ¯”è¾ƒå¥‡æ€ªçš„ä»£ç ä¸Šã€‚</p>
<h2 id="å†…å­˜ä¼˜åŒ–"><a href="#å†…å­˜ä¼˜åŒ–" class="headerlink" title="å†…å­˜ä¼˜åŒ–"></a>å†…å­˜ä¼˜åŒ–</h2><p>åœ¨ç›®å‰çš„å®ç°ä¸­ï¼Œç›¸æœºçš„é¢„è§ˆé¡µé‡‡ç”¨äº†open GL çš„æ–¹å¼æ¥å±•ç¤ºæ‘„åƒå¤´é‡‡é›†çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨æ ¹æ®äººè„¸è¯†åˆ«åçš„æ·»åŠ çš„stickerä¸Šè¿˜æ˜¯é‡‡ç”¨äº†Bitmapå’Œ canvas å®ç°çš„æ–¹å¼ï¼Œçœ‹åˆ°äº†bitmapå°±çŸ¥é“å†…å­˜æŠ–åŠ¨è¿™å—ä¸€å®šæ˜¯è·Ÿå®ƒæœ‰å…³äº†</p>
<ol>
<li>é—®é¢˜ä¸€ï¼šsticker èµ„æºçš„åŠ è½½<br>åœ¨ä¼˜åŒ–å‰å®ç°ä¸­ï¼Œé‡‡ç”¨çš„æ˜¯é€šè¿‡glideåŒæ­¥çš„è·å–bitmapå¯¹è±¡ï¼ŒåŒæ—¶é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—æ¥ç¼“å­˜åŠ è½½çš„å›¾ç‰‡ï¼Œä½†æ˜¯è¿™æ ·é¢å¯¹çš„ä¸€ä¸ªé—®é¢˜æ˜¯åœ¨ä¸€ä¸ªåŠ¨æ€çš„stickerä¸­ï¼Œå¦‚æœå‡ºç°çš„stickerè¿‡å¤šï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½é€ æˆè¿™ä¸ªé˜Ÿåˆ—ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆå®é™…ä¸Šé€ æˆçš„æ•ˆæœæ˜¯bitmapå¯¹è±¡æ ¹æœ¬æ²¡æœ‰åŠæ³•å¤ç”¨ã€‚ä¾‹å¦‚å®é™…ä¸Šè¿™ä¸ªé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡æ˜¯ 10ï¼Œ ä½†æ˜¯æˆ‘ä»¬æœ‰40å¼ å›¾ç‰‡éœ€è¦åŠ è½½çš„æ—¶å€™ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ ¹æœ¬èµ·ä¸åˆ°ç¼“å­˜çš„ä½œç”¨ï¼Œå¹¶ä¸”åœ¨stickerè¾ƒå¤§çš„æ—¶å€™è¿˜æ˜¯æ¯”è¾ƒå¤§çš„OOM é£é™©ã€‚</li>
</ol>
<p>1.1 å‡å°‘bitmap.<br>   é¦–å…ˆåˆ‡æ¢äº†æ€è·¯ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰é‡‡ç”¨é˜Ÿåˆ—çš„æ–¹å¼æ¥ç¼“å­˜æ‰€æœ‰çš„å›¾ç‰‡ï¼Œè€Œæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªç±»å‹çš„stickerèµ„æºéƒ½åªç¼“å­˜2ä¸ªbitmapï¼Œè¿™æ ·å°±å†…å­˜é‡Œé¢å…³äºstickerçš„bitmapæ•°é‡æœ€å¤§ä¸º10ä¸ªï¼ˆæœ‰äº›ç±»å‹çš„stickeråªæœ‰ä¸€ä¸ªå›¾ç‰‡èµ„æºï¼‰ï¼Œè¿™æ ·å¤§å¤§çš„å‡å°‘äº†stickerçš„å†…å­˜å ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹ŸåŸºæœ¬ä¸Šä¸ä¼šå‡ºç°OOM çš„é£é™©ï¼Œè™½ç„¶è¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šå‡ºç°stickeråŠ è½½æ…¢å¯¼è‡´çš„stickeræ‰å¸§æƒ…å†µï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªå¯¹è§†è§‰ä¸Šçš„å½±å“å¹¶ä¸å¤§ï¼ŒåŒæ—¶åŠ è½½æœ¬åœ°èµ„æºçš„æ—¶å€™ï¼ŒstickeråŠ è½½çš„é€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œå¹¶ä¸”å› ä¸ºåœ¨å­çº¿ç¨‹æ‰§è¡Œæ‰€ä»¥è¿™ä¸ªä¼˜åŒ–æ–¹æ³•æ˜¯å¯ä»¥é‡‡çº³çš„ã€‚</p>
<p>1.2 ä½¿ç”¨option.inBitmap å’Œ option.inMutable</p>
<p>   option.inBitmap æ˜¯ANDROID 11  ä¹‹åæ¨å‡ºçš„å±æ€§ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§åœ¨åŠ è½½bitmapæ—¶å€™å¯ä»¥å¤ç”¨inBItmap æ‰€æŒ‡å‘å¯¹è±¡çš„å†…å­˜è€Œä¸ç”¨é‡æ–°å¼€è¾Ÿå†…å­˜çš„å ç”¨ï¼Œè¿™ä¸ªå±æ€§åœ¨ä¸åŒçš„sdkåŸºæœ¬ä¸Šæœ‰ä¸åŒçš„é™åˆ¶è¦æ±‚ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬çš„åŒç±»å‹çš„stickeråºåˆ—çš„å›¾ç‰‡å¤§å°éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªé™åˆ¶é—®é¢˜ã€‚</p>
<p>  option.inMutable é€šè¿‡è¿™ä¸ªå±æ€§æˆ‘ä»¬å¯ä»¥è®©æ¯æ¬¡è¿”å›çš„bitmapéƒ½æ˜¯ä¹‹å‰çš„åŒä¸€ä¸ªå¯¹è±¡</p>
<p> è¿™é‡Œå¼•ç”¨ä¸€ä¸‹ä¸€ç¯‡<a href="https://juejin.im/entry/57cd1c7cbf22ec006c2e2261" target="_blank" rel="external">åšå®¢</a>çš„å†…å®¹</p>
<blockquote>
<p>inBitmap<br>Androidåœ¨API11æ·»åŠ çš„å±æ€§ï¼Œç”¨äºé‡ç”¨å·²æœ‰çš„Bitmapï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼Œæé«˜æ€§èƒ½ã€‚ä½†æ˜¯ä½¿ç”¨è¯¥å±æ€§å­˜åœ¨å¾ˆå¤šé™åˆ¶ï¼š åœ¨API19åŠä»¥ä¸Šï¼Œå­˜åœ¨ä¸¤ä¸ªé™åˆ¶æ¡ä»¶ï¼š<br>è¢«å¤ç”¨çš„Bitmapå¿…é¡»æ˜¯Mutableã€‚è¿åæ­¤é™åˆ¶ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¸”ä¼šè¿”å›æ–°ç”³è¯·å†…å­˜çš„Bitmapã€‚<br>è¢«å¤ç”¨çš„Bitmapçš„å†…å­˜å¤§å°ï¼ˆé€šè¿‡Bitmap.getAllocationByteCountæ–¹æ³•è·å¾—ï¼ŒAPI19åŠä»¥ä¸Šæ‰æœ‰ï¼‰å¿…é¡»å¤§äºç­‰äºè¢«åŠ è½½çš„Bitmapçš„å†…å­˜å¤§å°ã€‚è¿åæ­¤é™åˆ¶ï¼Œå°†ä¼šå¯¼è‡´å¤ç”¨å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸IllegalArgumentException(Problem decoding into existing bitmapï¼‰<br>åœ¨API11 ~ API19ä¹‹é—´ï¼Œè¿˜å­˜åœ¨é¢å¤–çš„é™åˆ¶ï¼š<br>è¢«å¤ç”¨çš„Bitmapçš„å®½é«˜å¿…é¡»ç­‰äºè¢«åŠ è½½çš„Bitmapçš„åŸå§‹å®½é«˜ã€‚ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯æŒ‡åŸå§‹å®½é«˜ï¼Œå³æ²¡è¿›è¡Œç¼©æ”¾ä¹‹å‰çš„å®½é«˜ï¼‰<br>è¢«åŠ è½½Bitmapçš„Options.inSampleSizeå¿…é¡»æ˜ç¡®æŒ‡å®šä¸º1ã€‚<br>è¢«åŠ è½½Bitmapçš„Options.inPreferredConfigå­—æ®µè®¾ç½®æ— æ•ˆï¼Œå› ä¸ºä¼šè¢«è¢«å¤ç”¨çš„Bitmapçš„inPreferredConfigå€¼æ‰€è¦†ç›–ï¼ˆä¸ç„¶ï¼Œæ‰€å å†…å­˜å¯èƒ½å°±ä¸ä¸€æ ·äº†ï¼‰</p>
</blockquote>
<p>1.3 ä½¿ç”¨bitmap pool</p>
<p>å› ä¸ºåœ¨æœ€ç»ˆçš„ç»˜åˆ¶åˆ°canvasçš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªbitmapï¼Œåœ¨ä¼˜åŒ–å‰æ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºäº†ä¸€ä¸ªbitmapå¯¹è±¡ï¼Œå®é™…ä¸Šè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ï¼Œåœ¨ä½¿ç”¨å®Œäº†bitmapä¹‹åå¯ä»¥é€šè¿‡bitmap pool ç¼“å­˜èµ·æ¥ï¼Œç„¶åå†æ¬¡ä½¿ç”¨ï¼Œåœ¨å†æ¬¡ä½¿ç”¨ä¹‹å‰é€šè¿‡btimap.erase() æ–¹æ³•æ¥æ“¦é™¤ä¹‹å‰çš„æ•°æ®ä¿¡æ¯å³å¯ï¼Œè¿™æ ·å°±é¿å…äº†æ¯æ¬¡éƒ½é‡å¤åˆ›å»ºæ–°çš„bitmapå¯¹è±¡ã€‚</p>
<h2 id="é”ä¼˜åŒ–"><a href="#é”ä¼˜åŒ–" class="headerlink" title="é”ä¼˜åŒ–"></a>é”ä¼˜åŒ–</h2><p>åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹é”çš„ä½¿ç”¨çš„ç¡®æ˜¯é¿ä¸å¼€çš„ï¼Œä½†æ˜¯åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œæ˜¯å¯ä»¥é¿å…é”çš„ä½¿ç”¨çš„ã€‚ä¾‹å¦‚åœ¨è¿™æ¬¡å¼€å‘çš„APPä¸­ï¼Œæ‘„åƒå¤´çš„æ•°æ®é€šè¿‡å›è°ƒçš„æ–¹å¼ä¼ é€’è¿‡æ¥ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼ŒåŒæ—¶é€šè¿‡äººè„¸è¯†åˆ«çš„å­çº¿ç¨‹å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œäººè„¸è¯†åˆ«çš„æ•°æ®çš„å¤„ç†ã€‚å› ä¸ºæ‘„åƒå¤´æ•°æ®å­˜æ”¾åœ¨ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡ä¸­ï¼Œä¸»çº¿ç¨‹ä¼šè¿›è¡Œå†™æ“ä½œï¼Œè€Œå­çº¿ç¨‹ä¼šè¿›è¡Œè¯»å†™ä¸¤ä¸ªæ“ä½œï¼Œåœ¨ä¼˜åŒ–å‰ä¸¤ä¸ªçº¿ç¨‹æ“ä½œè¿™ä¸ªæ•°æ®éƒ½åŠ ä¸Šäº†é”ã€‚ä½†æ˜¯å®é™…ä¸Šåˆ†æä¸€ä¸‹ä¼šå‘ç°åŠ é”çš„æƒ…å†µæ˜¯å¯ä»¥é¿å…çš„ã€‚é”çš„ä½œç”¨å°±æ˜¯è®©ä¸¤ä¸ªæ“ä½œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¸ä¼šäº¤å‰è¿›è¡Œï¼Œæ—¢ç„¶æ˜¯å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæƒ…å†µå˜æˆå•çº¿ç¨‹çš„å³å¯,åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<p>æ‰€ä»¥ä¼˜åŒ–æ“ä½œä¸­ï¼Œç›´æ¥æŠŠå­çº¿ç¨‹è¯»å†™æ“ä½œæ”¾åˆ°äº†ä¸»çº¿ç¨‹å½“ä¸­ï¼Œè¿™æ ·æ•°æ®çš„æ“ä½œå°±é¿å…åŠ é”çš„æƒ…å†µã€‚</p>
<p>é€šè¿‡å¯¹æ¯”å‰åçš„æ“ä½œï¼Œä¸€ä¸ªæ–¹æ³•çš„å¹³å‡æ‰§è¡Œæ—¶é—´ä»32msé™ä½åˆ°äº† 0.4ms,ä¼˜åŒ–æœ‰æå¤§çš„æå‡ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/25/é”çš„å¯é‡å…¥/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/25/é”çš„å¯é‡å…¥/" itemprop="url">é”çš„å¯é‡å…¥</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-06-25T21:50:53+08:00">
                2017-06-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¯·æ±‚ä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„é”çš„æ—¶å€™ï¼Œä¼šè¢«æŒ‚èµ·ã€‚ä½†æ˜¯å› ä¸ºé”çš„å¯é‡å…¥æ€§ï¼Œä¸€ä¸ªçº¿ç¨‹å†æ¬¡è¯·æ±‚è¢«è‡ªå·±æŒæœ‰çš„é”ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šæˆåŠŸã€‚é”çš„å¯é‡å…¥æ€§æ„å‘³ç€é”çš„å æœ‰æ˜¯åŸºäºçº¿ç¨‹çš„è€Œä¸æ˜¯åŸºäºè°ƒç”¨æ¬¡æ•°çš„ã€‚</p>
<p>é”çš„å¯é‡å…¥æ€§é€šè¿‡ä¸€ä¸ªé”çš„å ç”¨è®¡æ•°å’Œå½“å‰å ç”¨çº¿ç¨‹æ¥å®ç°ï¼Œå½“å ç”¨è®¡æ•°æ˜¯é›¶çš„æ—¶å€™ï¼Œè¿™ä¸ªé”ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæœªè¢«å ç”¨çš„é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚ä¸€ä¸ªæœªå ç”¨çš„é”çš„æ—¶å€™ï¼ŒJVMä¼šè®°å½•å ç”¨é”çš„å½“å‰çº¿ç¨‹ï¼Œç„¶åè®¾ç½®å ç”¨è®¡æ•°ä¸º1. å¦‚æœå½“å‰æŒæœ‰çº¿ç¨‹å†æ¬¡è¯·æ±‚è¿™ä¸ªé”ï¼Œé‚£ä¹ˆè®¡æ•°å™¨å°†ä¼šåŠ 1. å¦‚æœå½“å‰çº¿ç¨‹é€€å‡ºåŒæ­¥å—ï¼Œé‚£ä¹ˆé”å ç”¨è®¡æ•°å°†ä¼šå‡1ï¼Œå¦‚æœæœ€åçš„å ç”¨è®¡æ•°ä¸ºé›¶ï¼Œé‚£ä¹ˆé”å°†ä¼šè¢«é‡Šæ”¾</p>
<p>é”çš„å¯é‡å…¥æ€§æå¤§çš„ç®€åŒ–äº†é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä»£ç ï¼Œå¦‚æœæ²¡æœ‰é”çš„å¯é‡å…¥æ€§ï¼Œé‚£ä¹ˆä¸€äº›å³ä½¿çœ‹èµ·æ¥å¾ˆç®€å•çš„ä»£ç ä¹Ÿä¼šå‡ºé”™ã€‚</p>
<pre><code>public class Base {
    public synchronized void method() {

    }
}   
public class Sub extends Base {
    public synchronized void method() {
        //do something 
        super.method();
    }
}
</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœæ²¡æœ‰é”çš„å¯é‡å…¥æ€§ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒSubçš„ method æ–¹æ³•æ—¶ï¼Œé¦–å…ˆä¼šè·å–Subå½“å‰å®ä¾‹çš„é”ï¼Œå½“æ—¶åœ¨è°ƒç”¨superçš„æ—¶å€™ï¼ŒåŒæ ·éœ€è¦å½“å‰å®ä¾‹çš„é”ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ç¬¬ä¸€æ¬¡å–å¾—çš„é”å¹¶æ²¡æœ‰é‡Šæ”¾ï¼Œæ‰€ä»¥è¿™æ ·ä¾¿å½¢æˆäº†æ­»é”ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/25/TCPå­¦ä¹ ç¬”è®°2-æ»‘åŠ¨çª—å£/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/25/TCPå­¦ä¹ ç¬”è®°2-æ»‘åŠ¨çª—å£/" itemprop="url">TCPå­¦ä¹ ç¬”è®°2 æ»‘åŠ¨çª—å£</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-06-25T17:58:54+08:00">
                2017-06-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>TCPè¿æ¥çš„æ¯ä¸€ç«¯éƒ½å¯ä»¥æ”¶å‘æ•°æ®ï¼Œè¿™äº›æ”¶å‘æ•°æ®çš„ç®¡ç†æ˜¯é€šè¿‡æ»‘åŠ¨çª—å£çš„ç»“æ„æ¥æ¥ç»´æŠ¤çš„</p>
<h2 id="å‘é€çª—å£"><a href="#å‘é€çª—å£" class="headerlink" title="å‘é€çª—å£"></a>å‘é€çª—å£</h2><p>TCPåè®®ä»¥å­—èŠ‚ä¸ºå•ä½æ¥ç»´æŠ¤çª—å£ï¼Œå…¶ä¸­å¯ä»¥ä¸ºåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†</p>
<ol>
<li>å·²ç»å‘é€å¹¶ä¸”å·²ç»æ”¶åˆ°ACK çš„éƒ¨åˆ†</li>
<li>å·²ç»å‘é€ä½†æ˜¯æœªæ”¶åˆ°ACK å’Œ å³å°†å‘é€çš„éƒ¨åˆ†</li>
<li>çª—å£ç§»åˆ°è¯¥ä½ç½®å‰éƒ½ä¸å¯ä»¥å‘é€çš„éƒ¨åˆ†</li>
</ol>
<p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå‘é€ç«¯ä¸æ–­çš„å‘é€å’Œæ¥æ”¶åˆ°ACKï¼Œå¹¶ä¸”æ¥æ”¶åˆ°æ¥æ”¶ç«¯çš„çª—å£é€šå‘Šï¼Œå‘é€ç«¯çš„çª—å£ä¼šä¸ç®—çš„å¾€å³ç§»åŠ¨ï¼Œ</p>
<p>ä¸‹é¢çš„ä¸‰ä¸ªå±äºæè¿°äº†çª—å£çš„ç§»åŠ¨æƒ…å†µ</p>
<ol>
<li>å…³é—­ çª—å£çš„å·¦è¾¹ç•Œå³ç§»ï¼Œå½“æ¥æ”¶åˆ°å·²ç»å‘é€æ•°æ®çš„ACKçš„æ—¶å€™ï¼Œçª—å£ä¼šå‡å°</li>
<li>æ‰“å¼€ å³çª—å£çš„å³è¾¹ç•Œå³ç§»ï¼Œä½¿å¾—å¯ä»¥å‘é€çš„æ•°é‡å¢å¤§ï¼Œè¿™é€šå¸¸æ˜¯å› ä¸ºæ¥æ”¶ç«¯çš„å¤„ç†äº†æ•°æ®ï¼Œç¼“å­˜åŒºå˜å¤§ï¼Œå‘é€äº†ä¸€ä¸ªæ›´å¤§çš„çª—å£é€šå‘Šã€‚</li>
<li>æ”¶ç¼© å³çª—å£çš„å³è¾¹ç•Œå·¦ç§»ï¼Œ</li>
</ol>
<p>TCPçš„æ¯ä¸ªæŠ¥æ–‡éƒ½åŒ…å«ackå·å’Œçª—å£é€šå‘Šä¿¡æ¯ï¼ŒTCPå‘é€ç«¯å¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯è°ƒèŠ‚çª—å£çš„å¤§å°ï¼Œçª—å£çš„å·¦è¾¹ç•Œä¸èƒ½å‘å·¦ç§»åŠ¨ï¼Œå› ä¸ºå·¦è¾¹ç•Œè®°å½•çš„æ˜¯æ¥æ”¶ç«¯çš„ç¡®è®¤ä¿¡æ¯ï¼Œå…·æœ‰ç´¯è®¡æ€§ä¸èƒ½è¿”å›ã€‚</p>
<h2 id="æ¥æ”¶çª—å£"><a href="#æ¥æ”¶çª—å£" class="headerlink" title="æ¥æ”¶çª—å£"></a>æ¥æ”¶çª—å£</h2><p>æ¥æ”¶ç«¯ä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªæ¥æ”¶çª—å£ï¼Œçª—å£è®°å½•äº†å·²ç»æ¥æ”¶å¹¶ä¸”ç¡®è®¤çš„æ•°æ®ï¼Œä»¥åŠèƒ½æ¥æ”¶åˆ°çš„æœ€å¤§åºåˆ—å·ï¼Œæ¥æ”¶ç«¯å¸Œæœ›é¿å…å­˜å‚¨é‡å¤æ¥æ”¶çš„æ•°æ®å’Œå·²ç»ç¡®è®¤çš„æ•°æ®ï¼Œå¹¶ä¸”é¿å…å­˜å‚¨ä¸åº”è¯¥æ¥æ”¶çš„æ•°æ®(è¶…è¿‡å³è¾¹ç•Œçš„æ•°æ®ï¼‰</p>
<p>å¦‚æœæ¥æ”¶åˆ°äº†çª—å£å·¦è¾¹ç•Œä»¥å·¦çš„æ•°æ®ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®å°†ä¼šè¢«ä¸¢å¼ƒï¼Œå› ä¸ºè¿™äº›æ•°æ®å·²ç»è¢«ç¡®è®¤æ¥å—è¿‡ï¼Œè¶…è¿‡äº†å³è¾¹ç•Œçš„æ•°æ®è¢«è®¤ä¸ºæ— æ³•å¤„ç†ä¹Ÿä¼šè¢«ä¸¢å¼ƒã€‚åªæœ‰å½“æ¥æ”¶æ•°æ®çš„åºåˆ—å·åˆ°ç­‰äºå·¦è¾¹ç•Œçš„æ—¶å€™ï¼Œæ•°æ®æ‰ä¼šè¢«æ¥æ”¶å¤„ç†ï¼Œçª—å£æ‰ä¼šå‘å‰æ»‘åŠ¨ï¼Œå¯¹äºä½¿ç”¨äº†SACKçš„æŠ¥æ–‡æ¥è¯´ï¼Œè¿™ä¸ªçª—å£å†…çš„å…¶ä»–çš„æŠ¥æ–‡ä¹Ÿèƒ½è¢«æ¥æ”¶ï¼Œä½†æ˜¯åªæœ‰æ¥æ”¶åˆ°ç­‰äºå·¦è¾¹çš„æ•°æ®æ—¶ï¼Œçª—å£æ‰ä¼šç§»åŠ¨ã€‚</p>
<h2 id="çª—å£é€šå‘Š"><a href="#çª—å£é€šå‘Š" class="headerlink" title="çª—å£é€šå‘Š"></a>çª—å£é€šå‘Š</h2><p>é€šè¿‡çª—å£é€šå‘Šï¼ŒTCP çš„æ¥æ”¶æ–¹å¯ä»¥æœ‰æ•ˆçš„æ§åˆ¶å‘é€ç«¯çš„å‘é€é€Ÿç‡ï¼Œå½“å½“å‰çš„çª—å£ä¸ºé›¶çš„æ—¶å€™ï¼Œå¯ä»¥æœ‰æ•ˆçš„é˜»æ­¢å‘é€ç«¯å‘é€æ–°çš„æ•°æ®ã€‚å½“æ¥æ”¶ç«¯å·²ç»æˆåŠŸå¤„ç†äº†æ¥æ”¶åˆ°çš„æ•°æ®ï¼Œæœ‰é‡æ–°å¯ç”¨çš„ç¼“å­˜ç©ºé—´çš„æ—¶å€™ï¼Œå°±å¯ä»¥å‘é€ä¸€ä¸ªçª—å£é€šå‘Šç»™å‘é€æ–¹ï¼Œæ¥æ¢å¤å‘é€ã€‚è¿™æ ·çš„çª—å£é€šå‘Šé€šå¸¸éƒ½ä¸åŒ…æ‹¬æ•°æ®ï¼Œæˆä¸ºçº¯ACKï¼Œçª—å£é€šå‘Šé€šå¸¸é‡‡ç”¨ä¸å¯é çš„æ–¹å¼ä¼ è¾“ã€‚</p>
<p>åœ¨æ¥æ”¶ç«¯å‘é€ä¸€ä¸ªçª—å£é€šå‘Šçš„åŒæ—¶ï¼Œå‘é€æ–¹è¿˜å¯ä»¥é€šè¿‡çª—å£æ¢æµ‹çš„æ–¹å¼æŸ¥è¯¢å½“å‰å¯ç”¨çª—å£ï¼Œå‘é€æ–¹å‘é€çš„çª—å£æ¢æµ‹åŒ…æ‹¬ä¸€ä¸ªæœ‰æ•ˆçš„å­—èŠ‚ï¼Œé‡‡ç”¨TCPçš„å¯é ä¼ è¾“ï¼ˆä¸¢å¤±é‡ä¼ ï¼‰ï¼Œè¿™æ ·å°±é¿å…äº†ç”±çª—å£é€šå‘Šä¸¢å¤±å¯¼è‡´çš„é›¶çª—å£æ­»é”ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/24/FFMPEGè®°å½•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/24/FFMPEGè®°å½•/" itemprop="url">FFMPEGè®°å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-06-24T20:50:21+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä½¿ç”¨çš„ä¸¤ä¸ªå…³é”®å‘½ä»¤ </p>
<pre><code>ffmpeg 
    -framerate 10 
    -start_number 1 
    -i app_imagecache/3461686%04d.png 
    -i logo.png 
    -i pa.png 
    -vframes 44 
    -filter_complex &quot;[1:v]scale=50:50[water];[0:v][water]overlay=0:0[x];[x][2:v] paletteuse,reverse&quot; 
    -y logo.gif
</code></pre><p>ä¸‹é¢æ¥ç®€å•çš„è§£æä¸€ä¸‹è¿™æ®µå‘½ä»¤ </p>
<ul>
<li>framerate æŒ‡å®šç”Ÿæˆgifçš„ å¸§ç‡ï¼Œç›®å‰ffmpeg æœ€å¿«æ”¯æŒä¸º 20ms/æ¯å¸§ï¼Œæ‰€ä»¥è¿™é‡Œçš„å¸§ç‡æœ€å¤§0ä¸º 50</li>
<li>start_number æŒ‡å®šå›¾ç‰‡è¾“å…¥åºåˆ—çš„å¯ç¤ºä½ç½®</li>
<li>-i  app_imagecache/3461686%04d.png æŒ‡å®šç”Ÿæˆgifçš„ å›¾ç‰‡åºåˆ—</li>
<li>-i logo.png æŒ‡å®šæ°´å°</li>
<li>vframes æŒ‡å®šå¸§æ•°</li>
<li>-filter_complex â€œ[1:v]scale=50:50[water];[0:v] [water]overlay=0:0[x];[x][2:v]paletteuse,reverseâ€</li>
</ul>
<p>è¿™ä¸€æ®µæŒ‡å®šå¯¹è¾“å…¥çš„å¤„ç† [1:v]å®é™…ä¸ŠæŒ‡å®šäº†å‘½ä»¤çš„ä¸­çš„è¾“å…¥å‚æ•°ï¼Œè¿™é‡Œçš„ 1 è¡¨ç¤ºå‚æ•°çš„åºå·ï¼Œåºå·æ˜¯åŸºäº0å¼€å§‹çš„ï¼Œè¿™é‡Œå®é™…ä¸ŠæŒ‡å‘äº†ç¬¬äºŒä¸ªè¾“å…¥å‚æ•°ä¹Ÿå°±æ˜¯ logo.png. scaleè¯´æ˜å¯¹è¿™ä¸ªæ°´å°çš„å¤§å°ï¼Œè¿™é‡ŒæŒ‡å®šäº†é«˜å®½ä¸º 50ã€æ¥ä¸‹æ¥è·Ÿç€äº†ä¸€ä¸ª[water]è¿™ä¸ªå°±è¡¨ç¤ºå¯¹ä¸Šä¸€ä¸ªæ­¥éª¤å¤„ç†ç»“æœçš„é‡å‘½åï¼Œåœ¨åç»­çš„æ“ä½œä¸­å°±å¯ä»¥ç”¨è¿™ä¸ªé‡å‘½åæ¥æŒ‡ä»£ã€‚æ¥ä¸‹æ¥ä½¿ç”¨[water] è¡¨ç¤ºä¸Šä¸€æ­¥æŒ‡å®šä¸º 50:50 çš„è¿™ä¸ªæ°´å° åç§»é‡ ä¸º0:0ï¼› æ¥ä¸‹æ¥æ˜¯[x][2:v] è¿™ä¸¤ä¸ªå•ç‹¬çš„æ„æ€éƒ½èƒ½ç†è§£ï¼Œæ”¾åœ¨ä¸€èµ·çš„ç†è§£åº”è¯¥æ˜¯å¯¹å°†[2:v]æ‰€è‡´çš„ç»“æœåº”ç”¨åˆ°[x]ä¸Šé¢å»ï¼Œ[2:v] æ‰§è¡Œäº†ç¬¬ä¸‰ä¸ªè¾“å…¥å‚æ•°å³pa.pngï¼Œ åé¢è·Ÿç€äº†paletteuseï¼ŒåŠ ä¸Šè¿™ä¸ªæ˜¯ä¸ºäº†æå‡äº†gifå›¾åƒçš„è´¨é‡ï¼Œä¸ºgifåˆ¶å®šäº†ä¸€ä¸ªå…¨å±€çš„è°ƒè‰²ç›˜ã€‚</p>
<p>å†æ¥ä¸‹æ¥çš„reverse åˆ¶å®šäº†æ•´ä¸ªgifæŒ‰ç…§å€’åºçš„æ–¹å¼ç”Ÿæˆã€‚</p>
<p>åˆšåˆšè¯´åˆ°äº†gifçš„è°ƒè‰²ç›˜ï¼Œç”Ÿæˆçš„æ–¹å¼å¦‚ä¸‹</p>
<pre><code>ffmpeg
-i source
-vf palettegen
-y palettegen.png
</code></pre><p>-i å³æˆ‘ä»¬åˆ¶å®šçš„ç”Ÿæˆè°ƒè‰²ç›˜çš„æºæ–‡ä»¶ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬çš„gifæ¥æºäºè§†é¢‘ï¼Œæ‰€ä»¥åœ¨ç”Ÿæˆè°ƒè‰²ç›˜çš„æ—¶å€™ï¼Œè¿™é‡Œåˆ¶å®šä¸º è§†é¢‘çš„è·¯å¾„ã€‚</p>
<p>å¼€å‘çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œ ä»åˆ¶å®šçš„æ—¶é—´å¼€å§‹å–è§†é¢‘å¸§çš„æ—¶å€™ï¼Œéå¸¸çš„æ…¢ï¼Œå› ä¸ºéœ€è¦ä»å¤´å¼€å§‹è§£æï¼Œæ‰€ä»¥åæ¥çš„åšæ³•å°±æ˜¯å…ˆæˆªå–è§†é¢‘ï¼Œç„¶åæˆªå–åçš„è§†é¢‘ä¸­å¼€å§‹å–å¸§ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/12/TCPå­¦ä¹ ç¬”è®°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/12/TCPå­¦ä¹ ç¬”è®°/" itemprop="url">TCPå­¦ä¹ ç¬”è®°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-06-12T23:47:20+08:00">
                2017-06-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>TCP å’ŒUDP éƒ½æ˜¯è¿è¡Œåœ¨IPå±‚ä¹‹ä¸Šçš„åè®®ï¼Œä½†æ˜¯å’ŒUDPåè®®å¾ˆå¤§çš„ä¸€ä¸ªä¸åŒç‚¹æ˜¯ï¼ŒTCPé¢å‘è¿æ¥çš„å¯é åè®®ã€‚é¢å‘è¿æ¥æ˜¯æŒ‡åœ¨TCPå¼€å§‹ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œä¼ è¾“çš„ç«¯ç‚¹ä¹‹é—´éœ€è¦å…ˆå»ºç«‹ä¸€æ¡è¿æ¥ï¼Œç„¶åå†å¼€å§‹ä¼ è¾“æ•°æ®ï¼Œå¯é æ˜¯æŒ‡TCPåè®®ä¸­å¯¹æ•°æ®çš„å¯è¾¾æ€§ä½œå‡ºäº†ä¿è¯ï¼Œå¦‚æœåœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­å‡ºç°äº†æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œé‚£ä¹ˆä¼šå¯¹æ•°æ®è¿›è¡Œé‡ä¼ ï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªä¸åŒç‚¹ï¼Œæ‰€ä»¥TCPåè®®æ¯”UDPåè®®ä¼šå¤æ‚å¾ˆå¤šï¼Œåœ¨TCP/IPåè®®è¯¦è§£ä¸€ä¹¦ä¸­ï¼ŒèŠ±äº†å…­ä¸ªç« èŠ‚æ¥è®²è§£å…¶ä¸­çš„çŸ¥è¯†ã€‚å…¶ä¸­çš„åŸºæœ¬çŸ¥è¯†ç‚¹åŒ…æ‹¬ï¼šè¿æ¥çš„å»ºç«‹ï¼Œè¶…æ—¶å’Œé‡ä¼ ï¼Œæ•°æ®æµå’Œçª—å£ç®¡ç†ï¼Œæ‹¥å¡å’Œæ§åˆ¶.</p>
<h2 id="TCP-æ•°æ®æ ¼å¼"><a href="#TCP-æ•°æ®æ ¼å¼" class="headerlink" title="TCP æ•°æ®æ ¼å¼"></a>TCP æ•°æ®æ ¼å¼</h2><p>TCPçš„æ•°æ®æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="http://docs.52im.net/extend/docs/book/tcpip/vol1/17/images2/52im_net_2.png" alt="æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"></p>
<ol>
<li>æ¯ä¸ªTCPçš„å¤´éƒ¨éƒ½åŒ…å«äº†ç›®çš„åœ°çš„ç«¯å£å·å’Œæºç«¯å£å·ï¼ŒTCPå±‚çš„ç«¯å£å·å’ŒIPæˆçš„ipåœ°å€ï¼Œç»„æˆäº†ä¸€ä¸ªå››å…ƒç»„ï¼Œè¿™ä¸ªå››å…ƒç»„å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿æ¥ã€‚ </li>
<li>32ä½çš„åºåˆ—å·ä»£è¡¨äº†è¯¥æ•°æ®ä¸­åŒ…ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚</li>
<li>32å¯¹ç¡®è®¤å·æ˜¯æŒ‡è¯¥æ•°æ®åŒ…çš„å‘é€æ–¹å¸Œæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªåºåˆ—å·ï¼Œè¿™ä¸ªå€¼æ˜¯å¯¹å½“å‰å·²ç»æ¥æ”¶çš„åºåˆ—å·åŠ ä¸€æ‰€å¾—ã€‚</li>
<li>4ä½çš„å¤´éƒ¨é•¿åº¦æ ‡è¯†tcpå¤´éƒ¨çš„é•¿åº¦ï¼Œè¿™ä¸ªå€¼æœ€å¤§ä½15ï¼Œæ¯ä½æ ‡è¯†32ä½çš„é•¿åº¦ï¼Œæ‰€ä»¥TCPå¤´éƒ¨é•¿åº¦é™åˆ¶ä¸º 15 * 32(bit) = 60å­—èŠ‚ï¼Œåœ¨ä¸å¸¦é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œå¤´éƒ¨é•¿åº¦ä¸º20å­—èŠ‚ã€‚</li>
<li>å½“å‰TCPåè®®å½“ä¸­è¿˜æœ‰8ä½å­—æ®µï¼Œåˆ†åˆ«æ ‡è¯† 1.æ‹¥å¡çª—å£å‡ 2.ECNå›æ˜¾ 3.URG 4.ACK 5.PSH 6.RST 7.SYN 8.FIN è¿™äº›ç½®ä½åˆ†åˆ«åœ¨è¿æ¥çš„ä¸åŒé˜¶æ®µèµ·ä½œç”¨</li>
</ol>
<h2 id="TCPè¿æ¥çš„å»ºç«‹"><a href="#TCPè¿æ¥çš„å»ºç«‹" class="headerlink" title="TCPè¿æ¥çš„å»ºç«‹"></a>TCPè¿æ¥çš„å»ºç«‹</h2><p>TCPè¿æ¥çš„å»ºç«‹éœ€è¦ç»å…¸çš„ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚è¿‡ç¨‹å¦‚ä¸‹</p>
<p><img src="http://docs.52im.net/extend/docs/book/tcpip/vol1/19/images2/52im_net_1.png" alt="æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"></p>
<ol>
<li>å®¢æˆ·ç«¯é¦–å…ˆå‘é€ä¸€ä¸ªSYNæŠ¥æ–‡(TCPå¤´éƒ¨ä¸­çš„SYNè¢«ç½®ä½)ï¼Œå¹¶ä¸”æŒ‡æ˜è‡ªå·±æƒ³è¦è¿æ¥çš„ç«¯å£å·å’Œç»™å®šä¸€ä¸ªåˆå§‹åŒ–çš„åºåˆ—å·SYN(c)ã€‚ï¼ˆç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼‰</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªå®¢æˆ·ç«¯çš„SYN æŠ¥æ–‡ä¹‹åç»™å‡ºä¸€ä¸ªå“åº”ï¼Œåœ¨è¿™ä¸ªå“åº”å½“ä¸­ï¼ŒæœåŠ¡å™¨ç»™å‡ºäº†è‡ªå·±çš„åˆå§‹åŒ–åºåˆ—å·SYN(s)ï¼Œæ­¤æ—¶ä¸ºäº†å¯¹ç¡®è®¤å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šå°†å®¢æˆ·ç«¯å‘é€çš„åºåˆ—å·åŠ ä¸€ä¹‹åæ”¾åœ¨TCPå¤´éƒ¨çš„ç¡®è®¤å·å­—æ®µå½“ä¸­ACK(c+1)ï¼Œå› æ­¤æ¯å‘é€ä¸€ä¸ªsynï¼Œåºåˆ—å·éƒ½ä¼šåŠ 1.ï¼ˆç¬¬äºŒæ¬¡æ¡æ‰‹ï¼‰</li>
<li>ä¸ºäº†ç¡®è®¤æœåŠ¡å™¨ç«¯SYNï¼ˆSï¼‰ï¼Œå®¢æˆ·ç«¯ä¼šå°†æœåŠ¡å™¨ç«¯çš„S + 1ä¹‹åæ”¾åœ¨ACK(S+1)ä¸­ï¼Œå‘é€ç»™æœåŠ¡ç«¯ã€‚ï¼ˆç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼‰</li>
</ol>
<p>ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ä¸ä»…è®©é€šä¿¡çš„åŒæ–¹äº†è§£åˆ°ä¸€ä¸ªè¿æ¥æ­£åœ¨å»ºç«‹ï¼ŒåŒæ—¶ä¹Ÿåœ¨åˆ©ç”¨æ•°æ®åŒ…çš„é€‰é¡¹æ¥äº¤æ¢åˆå§‹åºåˆ—å·ã€‚</p>
<h2 id="TCPè¿æ¥çš„æ–­å¼€"><a href="#TCPè¿æ¥çš„æ–­å¼€" class="headerlink" title="TCPè¿æ¥çš„æ–­å¼€"></a>TCPè¿æ¥çš„æ–­å¼€</h2><p>ä¸TCP è¿æ¥çš„å»ºç«‹ç›¸æ¯”ï¼ŒTCP è¿æ¥çš„æ–­å¼€å¤šäº†ä¸€æ­¥ï¼Œä¸€å…±éœ€è¦å››ä¸ªæ­¥éª¤ã€‚</p>
<ol>
<li>è¿æ¥çš„ä¸»åŠ¨å…³é—­è€…ï¼ˆClientï¼‰ï¼Œå‘é€ä¸€ä¸ªFINæŠ¥æ–‡æ¥è¡¨ç¤ºè‡ªå·±æƒ³å…³é—­è¿æ¥ï¼ŒåŒæ—¶è¿™ä¸ªæŠ¥æ–‡é‡Œé¢è¿˜åŒ…æ‹¬ä¸€ä¸ªACKæ¥ç¡®è®¤å¯¹æ–¹æœ€è¿‘ä¸€æ¬¡å‘æ¥çš„æ•°æ®ã€‚</li>
<li>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯æ–­å¼€çš„è¯·æ±‚ä¹‹åï¼Œå‘é€ä¸€ä¸ªACKå¯¹å®¢æˆ·ç«¯çš„FIN æŠ¥æ–‡åšå‡ºå“åº”ï¼Œè¿™ä¸ªæ—¶å€™è¿æ¥å¤„äºåŠå…³é—­çŠ¶æ€ã€‚</li>
<li>æœåŠ¡ç«¯åœ¨å‘é€å®Œæ•°æ®ä¹‹åï¼ŒåŒæ ·å‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯ï¼Œæ¥å…³é—­è¿æ¥ã€‚</li>
<li>å®¢æˆ·ç«¯æ¥æ”¶åˆ°äº†FINä¹‹åï¼Œå¯¹æœåŠ¡ç«¯çš„FINåšå‡ºä¸€ä¸ªå“åº”ï¼Œè‡³æ­¤è¿æ¥å…³é—­ã€‚</li>
</ol>
<h2 id="åˆå§‹åŒ–åºåˆ—å·"><a href="#åˆå§‹åŒ–åºåˆ—å·" class="headerlink" title="åˆå§‹åŒ–åºåˆ—å·"></a>åˆå§‹åŒ–åºåˆ—å·</h2><p>TCPå»ºç«‹çš„è¿æ¥çš„æ—¶å€™éœ€è¦é€‰æ‹©ä¸€ä¸ªåˆå§‹åŒ–åºåˆ—å·ï¼Œè¿™ä¸ªåˆå§‹åŒ–åºåˆ—å·éšç€æ—¶é—´çš„å˜åŒ–è€Œå˜åŒ–ï¼Œæ‰€ä»¥æ¯ä¸ªè¿æ¥çš„åˆå§‹åŒ–åºåˆ—å·éƒ½ä¸ä¸€æ ·ã€‚</p>
<p>TCPè¿æ¥æ˜¯ç”±åŒæ–¹çš„ç«¯å£å’ŒIPåœ°å€è¿™ä¸ªå››å…ƒç»„ç»„æˆï¼Œé€‰æ‹©æœ‰æ•ˆçš„åˆå§‹åŒ–åºåˆ—å·å¯ä»¥æœ‰æ•ˆé¿å…è¿æ¥è¶…æ—¶é‡è¿åï¼Œæ— æ•ˆçš„æ•°æ®é‡æ–°åˆ°è¾¾ç›®çš„ä¸»æœºå¯¼è‡´çš„æ•°æ®æ··ä¹±é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™é€‰æ‹©æœ‰æ•ˆçš„åˆå§‹åŒ–åºåˆ—å·å¯ä»¥æœ€å¤§é™åº¦çš„é¿å…è¿™ä¸€é—®é¢˜ã€‚åœ¨åŒæ–¹é€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªTCPæŠ¥æ–‡åªæœ‰åŒæ—¶å…·å¤‡è¿æ¥å››å…ƒç»„å’Œå½“å‰æ´»åŠ¨çª—å£çš„åºåˆ—å·æ‰ä¼šè¢«é€šä¿¡åŒæ–¹æ¥å—ã€‚</p>
<h2 id="TCPé€‰é¡¹"><a href="#TCPé€‰é¡¹" class="headerlink" title="TCPé€‰é¡¹"></a>TCPé€‰é¡¹</h2><p>TCPçš„å¤´éƒ¨å¯ä»¥åŒ…å«å¤šä¸ªé€‰é¡¹ï¼Œå¸¸ç”¨çš„é€‰é¡¹å¦‚ä¸‹</p>
<ol>
<li>æœ€å¤§æ®µå¤§å°é€‰é¡¹ æŒ‡çš„æ˜¯å…è®¸ä»å¯¹æ–¹æ¥æ”¶åˆ°çš„æœ€å¤§æŠ¥æ–‡æ®µï¼Œè¿™ä¸ªæŠ¥æ–‡æ®µå¤§å°åªè®°å½•å™¨æ•°æ®çš„å‚åŒºè€Œä¸åŒ…æ‹¬TCPå’ŒIPåŒ…å¤´çš„é•¿åº¦ã€‚</li>
<li>é€‰æ‹©ç¡®è®¤é€‰é¡¹ è¿™ä¸ªå¯ä»¥å¸®åŠ©TCPå®ç°å¿«é€Ÿé‡ä¼ ï¼Œå¹¶ä¸”å¸®åŠ©å‘é€æ–¹äº†è§£åˆ°æ¥æ”¶æ–¹çš„ç©ºæ´ï¼Œ</li>
<li>çª—å£ç¼©æ”¾é€‰é¡¹ï¼ˆå¾…è¡¥å……ï¼‰</li>
<li>æ—¶é—´æˆ³é€‰é¡¹å’Œé˜²å›ç»•åºåˆ— è¿™ä¸ªé€‰é¡¹è¦æ±‚å‘é€æ–¹åœ¨æ¯ä¸€ä¸ªæŠ¥æ–‡ä¸­æ·»åŠ 2-4ä¸ªå­—èŠ‚çš„æ—¶é—´æˆ³æ•°å­—ï¼Œæ¥æ”¶æ–¹ä¼šåœ¨å“åº”ä¸­åæ˜ è¿™äº›æ•°å­—ï¼Œè¿™ä¹Ÿå…è®¸å‘é€æ–¹æ¥æµ‹é‡ä¸€ä¸ªRTT</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Tom Liu" />
          <p class="site-author-name" itemprop="name">Tom Liu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tom Liu</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
