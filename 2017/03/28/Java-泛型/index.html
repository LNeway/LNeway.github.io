<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Java,泛型," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Java中的泛型是在编译器这个级别实现的，在生成的Java字节码当中是没有泛型中的类型信息的，使用泛型的时候加上的类型参数会在编译的时候去掉，这个过程称作为类型擦除，如在代码中定义的List 和 List， 在编译之后都变成了List, JVM看到的只有List （所以这一点和C++中的模板是不同的，在C++中为每一个模板类生成一个类， 此外在Java中，泛型中还不支持基本类型） 而由泛型附加的类">
<meta name="keywords" content="Java,泛型">
<meta property="og:type" content="article">
<meta property="og:title" content="Java 泛型">
<meta property="og:url" content="http://yoursite.com/2017/03/28/Java-泛型/index.html">
<meta property="og:site_name" content="Learning">
<meta property="og:description" content="Java中的泛型是在编译器这个级别实现的，在生成的Java字节码当中是没有泛型中的类型信息的，使用泛型的时候加上的类型参数会在编译的时候去掉，这个过程称作为类型擦除，如在代码中定义的List 和 List， 在编译之后都变成了List, JVM看到的只有List （所以这一点和C++中的模板是不同的，在C++中为每一个模板类生成一个类， 此外在Java中，泛型中还不支持基本类型） 而由泛型附加的类">
<meta property="og:image" content="http://img.my.csdn.net/uploads/201209/04/1346768613_6175.png">
<meta property="og:updated_time" content="2017-03-28T14:23:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java 泛型">
<meta name="twitter:description" content="Java中的泛型是在编译器这个级别实现的，在生成的Java字节码当中是没有泛型中的类型信息的，使用泛型的时候加上的类型参数会在编译的时候去掉，这个过程称作为类型擦除，如在代码中定义的List 和 List， 在编译之后都变成了List, JVM看到的只有List （所以这一点和C++中的模板是不同的，在C++中为每一个模板类生成一个类， 此外在Java中，泛型中还不支持基本类型） 而由泛型附加的类">
<meta name="twitter:image" content="http://img.my.csdn.net/uploads/201209/04/1346768613_6175.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/03/28/Java-泛型/"/>





  <title>Java 泛型 | Learning</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Learning</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/28/Java-泛型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tom Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java 泛型</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-28T22:21:52+08:00">
                2017-03-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Java中的泛型是在编译器这个级别实现的，在生成的Java字节码当中是没有泛型中的类型信息的，使用泛型的时候加上的类型参数会在编译的时候去掉，这个过程称作为类型擦除，如在代码中定义的List<object> 和 List<string>， 在编译之后都变成了List, JVM看到的只有List （所以这一点和C++中的模板是不同的，在C++中为每一个模板类生成一个类， 此外在Java中，泛型中还不支持基本类型） 而由泛型附加的类型信息对JVM来说是不可见的，Java编译器会在编译的时候尽可能发现出错的地方，但是仍然无法避免运行时刻出现的强制类型转换异常，类型擦除也是Java的泛型实现方式与C++模板机制实现方式之间的重要区别。</string></object></p>
<p>泛型的很多奇怪特性都与类型擦除有关：</p>
<ul>
<li>泛型没有自己独有的Class类对象，比如不存在List<string>.class ，只有List.class;</string></li>
<li>静态变量被泛型类所有的实例共享，例如MyClass<t> 中定义静态变量 var , 访问这个静态变量的方式任然是MyClass.var。</t></li>
<li>泛型的参数类型不能用在Java的异常处理中，以为异常处理是由JVM的 Runtime 来处理的，但是由于类型擦除，所以JVM是不知道这个类型信息的存在的，对于JVM来说都是MyException.也就无法执行对应的catche语句。(目前在Intelij IDE中，定义的一个泛型的异常直接报错(Generic class may not extends java.lang.Throwable))</li>
</ul>
<p>这些原因的根源都是泛型的类型信息只是在编译期存在的，而在程序执行的时候无法找到的。</p>
<p>但是这里又有另外一个问题了，我们在程序运行的时候明明是可以通过API 拿到另一个类的泛型信息的，<br>class 对象由这两个方法 </p>
<ul>
<li>getGenericSuperclass()</li>
<li>getGenericInterface()</li>
</ul>
<p>那么这两个类拿到的泛型信息又是从哪里获取的呢？<br>Java文件在编译之后会生成字节码文件，字节码文件的结构如下图所示</p>
<p><img src="http://img.my.csdn.net/uploads/201209/04/1346768613_6175.png" alt="此处输入图片的描述"></p>
<p>接下来，先定义两个类型， </p>
<pre><code>public class MyClass  {
    List data;
    public void setData(List data) {
        this.data = data;
    }
}
public class MyClassString {
    List&lt;String&gt; data;
    public void setData(List&lt;String&gt; data) {
        this.data = data;
    }
}
</code></pre><p>在编译完成之后，我们可以通过javap 来获取两者生成的字节码</p>
<p>运行 javap -c MyClassString 结果如下</p>
<pre><code>public class com.baidu.accweather.MyClassString {
  java.util.List&lt;java.lang.String&gt; data;
  public com.baidu.accweather.MyClassString();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
       4: return

  public void setData(java.util.List&lt;java.lang.String&gt;);
    Code:
       0: aload_0
       1: aload_1
       2: putfield      #2                  // Field data:Ljava/util/List;
       5: return
}
</code></pre><p>运行javap  -c MyClass  结果如下</p>
<pre><code>public class com.baidu.accweather.MyClass {
  java.util.List data;
  public com.baidu.accweather.MyClass();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
       4: return

  public void setData(java.util.List);
    Code:
       0: aload_0
       1: aload_1
       2: putfield      #2                  // Field data:Ljava/util/List;
       5: return
}
</code></pre><p>这个时候通过对比发现出列data 的声明不同之外其他的地方完全一样，特别需要注意的是在setData当中，从注释来看 data， 它的类型信息里面已经没有了泛型类型的信息。</p>
<p>接下来我们需要用 -verbose 参数打印堆栈大小、各方法的locals及args参数，以及class文件的编译版本</p>
<p>运行javap -verbose MyClassString , 其常量池的信息输出如下（MyClass 的就不贴出来了）</p>
<pre><code>   Classfile /D:/javaworkspace/AccWeather/out/production/AccWeather/com/baidu/accweather/MyClassString.class
  Last modified 2017-3-27; size 610 bytes
  MD5 checksum caaccea4d689459e3464f2088a3efb34
  Compiled from &quot;MyClassString.java&quot;
public class com.baidu.accweather.MyClassString
  SourceFile: &quot;MyClassString.java&quot;
  minor version: 0
  major version: 51
  flags: ACC_PUBLIC, ACC_SUPER
Constant pool:
   #1 = Methodref          #4.#22         //  java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = Fieldref           #3.#23         //  com/baidu/accweather/MyClassString.data:Ljava/util/List;
   #3 = Class              #24            //  com/baidu/accweather/MyClassString
   #4 = Class              #25            //  java/lang/Object
   #5 = Utf8               data
   #6 = Utf8               Ljava/util/List;
   #7 = Utf8               Signature
   #8 = Utf8               Ljava/util/List&lt;Ljava/lang/String;&gt;;
   #9 = Utf8               &lt;init&gt;
  #10 = Utf8               ()V
  #11 = Utf8               Code
  #12 = Utf8               LineNumberTable
  #13 = Utf8               LocalVariableTable
  #14 = Utf8               this
  #15 = Utf8               Lcom/baidu/accweather/MyClassString;
  #16 = Utf8               setData
  #17 = Utf8               (Ljava/util/List;)V
  #18 = Utf8               LocalVariableTypeTable
  #19 = Utf8               (Ljava/util/List&lt;Ljava/lang/String;&gt;;)V
  #20 = Utf8               SourceFile
  #21 = Utf8               MyClassString.java
  #22 = NameAndType        #9:#10         //  &quot;&lt;init&gt;&quot;:()V
  #23 = NameAndType        #5:#6          //  data:Ljava/util/List;
  #24 = Utf8               com/baidu/accweather/MyClassString
  #25 = Utf8               java/lang/Object
{
  java.util.List&lt;java.lang.String&gt; data;
    flags:
    Signature: #8                           // Ljava/util/List&lt;Ljava/lang/String;&gt;;

  public com.baidu.accweather.MyClassString();
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
         4: return
      LineNumberTable:
        line 8: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
        0       5      0      this   Lcom/baidu/accweather/MyClassString;

  public void setData(java.util.List&lt;java.lang.String&gt;);
    flags: ACC_PUBLIC
    Code:
      stack=2, locals=2, args_size=2
         0: aload_0
         1: aload_1
         2: putfield      #2                  // Field data:Ljava/util/List;
         5: return
      LineNumberTable:
        line 12: 0
        line 13: 5
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
          0       6     0    this   Lcom/baidu/accweather/MyClassString;
          0       6     1    data   Ljava/util/List;
      LocalVariableTypeTable:
        Start  Length  Slot  Name   Signature
          0       6     1    data   Ljava/util/List&lt;Ljava/lang/String;&gt;;
    Signature: #19                          // (Ljava/util/List&lt;Ljava/lang/String;&gt;;)V
}
</code></pre><p>从setData 方法输出的信息来看， 里面有两张表，一个本地变量表，一个是变量类型表，从 LocalVariableTypeTable 中可以看出来 变量 data 的类型信息是 java/util/List<ljava lang="" string;=""><br>而最后 Signature 的属性在这里具体指明了是常量池中的#19，这里具体说明了这个方法的信息。</ljava></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/泛型/" rel="tag"># 泛型</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/26/C-拷贝控制/" rel="next" title="C++拷贝控制">
                <i class="fa fa-chevron-left"></i> C++拷贝控制
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/03/29/Java-异常处理/" rel="prev" title="Java 异常处理">
                Java 异常处理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Tom Liu" />
          <p class="site-author-name" itemprop="name">Tom Liu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">40</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">46</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tom Liu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
